---
phase: 04-county-data
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/workers/src/counties/types.ts
  - apps/workers/src/counties/sources.ts
  - apps/workers/src/lib/citations.ts
autonomous: true

must_haves:
  truths:
    - "All 10 target counties have documented source availability status"
    - "County source registry correctly identifies accessible vs inaccessible counties"
    - "County citations generate valid Bluebook format"
  artifacts:
    - path: "apps/workers/src/counties/types.ts"
      provides: "County type definitions (CountyOrdinance, CountySourceConfig, CountyCheckpoint, CountyChunk)"
      exports: ["CountyOrdinance", "CountySourceConfig", "CountyCheckpoint", "CountyChunk", "CountyAdapter"]
    - path: "apps/workers/src/counties/sources.ts"
      provides: "County source registry with 10 target counties"
      exports: ["TARGET_COUNTIES", "getEnabledCounties", "getSkippedCounties", "getCountyByName", "getCountyByFips"]
    - path: "apps/workers/src/lib/citations.ts"
      provides: "County citation generators"
      contains: "generateCountyCitation"
  key_links:
    - from: "apps/workers/src/counties/sources.ts"
      to: "apps/workers/src/counties/types.ts"
      via: "CountySourceConfig import"
      pattern: "import.*CountySourceConfig.*from.*types"
---

<objective>
Research 10 target Texas counties to identify source availability, then create county types, source registry, and citation generators.

Purpose: Establish the foundation for county data pipeline by documenting which counties have accessible online ordinance sources and creating type infrastructure that supports heterogeneous county platforms.

Output:
- County types matching the adapter pattern identified in research
- Source registry with enable/disable flags for each of 10 counties
- Bluebook-compliant citation generators for county ordinances and court orders
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-county-data/04-RESEARCH.md
@apps/workers/src/texas/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Research 10 target counties for source availability</name>
  <files>apps/workers/src/counties/sources.ts (research documentation embedded in code comments)</files>
  <action>
Research each of the 10 target Texas counties to determine:
1. Whether they have accessible online ordinance databases
2. Which platform they use (MunicipalCodeOnline, eLaws, AmLegal, custom, court-orders-only, or none)
3. Base URL for their ordinance source (if any)

Target counties (by FIPS code):
- Harris (48201) - KNOWN: MunicipalCodeOnline at https://harriscounty.municipalcodeonline.com/
- Dallas (48113) - KNOWN: eLaws at http://dallascounty-tx.elaws.us/code/coor
- Tarrant (48439)
- Bexar (48029)
- Travis (48453)
- Collin (48085)
- Denton (48121)
- Fort Bend (48157)
- Williamson (48491)
- El Paso (48141)

For each county:
1. Check for "Code of Ordinances" or "County Code" section on county website
2. Check if county is listed on codelibrary.amlegal.com, library.municode.com, or eLaws
3. Check if county has only commissioners court agendas/minutes (court orders only)
4. Document findings in sources.ts with clear comments

Per CONTEXT.md: If a county has no online ordinance library, mark as `enabled: false` with skipReason documented. Do NOT attempt manual outreach.
  </action>
  <verify>Sources registry contains all 10 counties with documented platform/URL or skipReason for each</verify>
  <done>Each county has either (a) platform + baseUrl + enabled:true, or (b) hasOnlineSource:false + enabled:false + skipReason</done>
</task>

<task type="auto">
  <name>Task 2: Create county types</name>
  <files>apps/workers/src/counties/types.ts</files>
  <action>
Create TypeScript interfaces following patterns from texas/types.ts and research recommendations:

1. **CountyOrdinance** - Individual ordinance/section from codified code:
   - county: string (e.g., "Harris")
   - fipsCode: string (e.g., "48201")
   - chapter: string
   - section: string
   - heading: string
   - text: string
   - subsections?: CountySubsection[]
   - sourceUrl: string
   - scrapedAt: string

2. **CourtOrder** - Commissioner court order (for counties without codes):
   - county: string
   - fipsCode: string
   - orderNumber: string
   - adoptionDate: string
   - title: string
   - text: string
   - sourceUrl: string
   - scrapedAt: string

3. **CountySourceConfig** - Registry entry for a county:
   - name: string
   - fipsCode: string
   - platform?: 'municode-online' | 'elaws' | 'amlegal' | 'custom' | 'court-orders'
   - baseUrl?: string
   - hasOnlineSource: boolean
   - enabled: boolean
   - skipReason?: string
   - categories: string[] (e.g., ['subdivision', 'zoning', 'building'])

4. **CountyChunk** - Processed chunk ready for embedding:
   - chunkId: string (e.g., "county-harris-1.02-0")
   - sourceId: string (e.g., "county-harris")
   - sourceType: 'county'
   - text: string
   - citation: string (Bluebook format)
   - url: string
   - county: string
   - fipsCode: string
   - chapter: string
   - section: string
   - chunkIndex: number
   - totalChunks: number
   - category?: string

5. **CountyCheckpoint** - Pipeline checkpoint:
   - sourceType: 'county'
   - lastProcessedCounty?: string
   - lastProcessedSection?: string
   - timestamp: string
   - chunksProcessed: number
   - status: 'in_progress' | 'completed' | 'failed'
   - error?: string

6. **CountyAdapter** interface - Abstract adapter for heterogeneous platforms:
   - county: string
   - fipsCode: string
   - baseUrl: string
   - platform: CountySourceConfig['platform']
   - fetchOrdinances(): AsyncGenerator<CountyOrdinance, void, unknown>
   - validateSource(): Promise<{ accessible: boolean; error?: string }>
  </action>
  <verify>TypeScript compilation succeeds: `pnpm -F @compliance-iq/workers exec tsc --noEmit`</verify>
  <done>All 6 types/interfaces exported and compile without errors</done>
</task>

<task type="auto">
  <name>Task 3: Create county citation generators</name>
  <files>apps/workers/src/lib/citations.ts</files>
  <action>
Add county citation generators following Bluebook Rule 12.9.2 (municipal ordinances cited analogously to statutes).

If citations.ts doesn't exist, create it. If it exists, add to existing exports.

Functions to implement:

1. **generateCountyCitation(county, codeName, section, year?)** - Codified ordinance citation
   - Format: "[County Name] County, Tex., [Code Name] sect. [section] ([year])"
   - Example: "Harris County, Tex., County Code sect. 1.02 (2026)"

2. **generateCourtOrderCitation(county, orderNumber, adoptionDate)** - Court order citation
   - Format: "[County Name] County Commissioners Court Order No. [number] ([date])"
   - Example: "Tarrant County Commissioners Court Order No. 2026-045 (Mar. 15, 2026)"
   - Use date-fns format() for date formatting: "MMM. d, yyyy"

3. **generateCountyOrdinanceUrl(config, section?)** - Generate URL for county ordinance
   - Handle platform-specific URL patterns for municode-online, elaws, amlegal
   - Throw error if county has no online source

Include JSDoc with examples for each function.
  </action>
  <verify>TypeScript compiles and exports are visible: `pnpm -F @compliance-iq/workers exec tsc --noEmit`</verify>
  <done>Three citation functions exported with JSDoc examples</done>
</task>

</tasks>

<verification>
1. All 10 counties documented in sources.ts with status
2. County types compile without errors
3. Citation generators produce valid Bluebook format
4. Test: `pnpm -F @compliance-iq/workers exec tsc --noEmit` passes
</verification>

<success_criteria>
- sources.ts contains TARGET_COUNTIES array with all 10 counties
- Each county has documented source availability (platform + URL or skipReason)
- types.ts exports all required interfaces
- citations.ts exports county citation generators
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-county-data/04-01-SUMMARY.md`
</output>
