---
phase: 06-data-processing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/workers/src/validation/types.ts
  - apps/workers/src/validation/index.ts
autonomous: true

must_haves:
  truths:
    - "Validation types define metrics for all data quality dimensions"
    - "Unified validation interface works across all jurisdiction types"
  artifacts:
    - path: "apps/workers/src/validation/types.ts"
      provides: "TypeScript interfaces for validation metrics"
      exports: ["DataQualityReport", "TokenDistribution", "CoverageReport", "ValidationResult", "R2ValidationResult", "ConvexValidationResult"]
    - path: "apps/workers/src/validation/index.ts"
      provides: "Module exports for validation types"
      exports: ["*"]
  key_links:
    - from: "apps/workers/src/validation/types.ts"
      to: "apps/workers/src/pinecone.ts"
      via: "ChunkMetadata reference"
      pattern: "import.*ChunkMetadata"
---

<objective>
Create validation type system and shared interfaces for data quality reporting.

Purpose: Establish type-safe foundation for Phase 6 validation tools. All subsequent plans depend on these types for consistent metrics across federal, state, county, and municipal pipelines.

Output: TypeScript interfaces for token distribution, coverage reports, metadata completeness, and validation results.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/workers/src/pinecone.ts
@apps/workers/src/lib/tokens.ts
@apps/workers/src/federal/types.ts
@apps/workers/src/counties/types.ts
@apps/workers/src/municipal/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create validation type definitions</name>
  <files>apps/workers/src/validation/types.ts</files>
  <action>
Create new file with TypeScript interfaces for data quality validation:

1. **TokenDistribution** - Statistics for chunk token counts:
   - min, max, avg, p50, p95, p99 (all numbers)
   - Used for analyzing chunk size distribution across jurisdictions

2. **MetadataCompleteness** - Counts of chunks with optional fields:
   - hasCategory: number
   - hasTitle: number
   - hasLastUpdated: number
   - Used to track how complete metadata is

3. **DataQualityReport** - Per-jurisdiction quality metrics:
   - jurisdiction: string (e.g., 'US', 'TX', 'TX-48201', 'TX-houston')
   - sourceType: 'federal' | 'state' | 'county' | 'municipal'
   - timestamp: string (ISO format)
   - totalChunks: number
   - tokenDistribution: TokenDistribution
   - citationCoverage: number (percentage 0-100)
   - metadataCompleteness: MetadataCompleteness
   - issues: Array<{chunkId: string; issue: string}>

4. **JurisdictionCoverage** - Single jurisdiction coverage status:
   - name: string
   - identifier: string (FIPS code, cityId, etc.)
   - expected: boolean
   - indexed: boolean
   - vectorCount: number
   - status: 'active' | 'pending' | 'error' | 'missing'
   - lastIndexedAt?: string

5. **CoverageReport** - Cross-jurisdiction coverage summary:
   - generatedAt: string
   - totalExpected: number
   - totalIndexed: number
   - coveragePercent: number
   - bySourceType: { federal, state, county, municipal } each with expected/indexed
   - jurisdictions: JurisdictionCoverage[]
   - gaps: Array<{jurisdiction: string; reason: string}>

6. **ValidationResult** - Overall validation outcome:
   - success: boolean
   - timestamp: string
   - qualityReports: DataQualityReport[]
   - coverageReport: CoverageReport
   - summary: { totalChunks, avgTokens, coveragePercent, issuesCount }

7. **R2ValidationResult** - R2 storage validation outcome:
   - valid: boolean
   - missingFolders: string[] (expected folders that don't exist)
   - jurisdictionsWithoutData: string[] (jurisdictions with no R2 objects)

8. **ConvexValidationResult** - Convex sync validation outcome:
   - valid: boolean
   - missingInConvex: string[] (jurisdictions not in Convex table)
   - staleJurisdictions: string[] (jurisdictions with null/missing lastScrapedAt)
   - vectorCountMismatches: Array<{jurisdiction: string, convex: number, pinecone: number}>

Import ChunkMetadata from '../pinecone' for type reference.
Add comprehensive JSDoc comments explaining each interface's purpose.
  </action>
  <verify>Run: cd apps/workers && pnpm exec tsc --noEmit src/validation/types.ts</verify>
  <done>All validation types compile without errors and have JSDoc documentation</done>
</task>

<task type="auto">
  <name>Task 2: Create module index export</name>
  <files>apps/workers/src/validation/index.ts</files>
  <action>
Create module index that re-exports all types:

```typescript
/**
 * Data Processing Validation Module
 *
 * Provides types and utilities for validating the end-to-end
 * data processing pipeline across all jurisdiction types.
 *
 * @module validation
 */

export * from './types';
```

This establishes the validation module structure for subsequent plans.
  </action>
  <verify>Run: cd apps/workers && pnpm exec tsc --noEmit src/validation/index.ts</verify>
  <done>Module exports compile successfully</done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes for all new files
2. All exported types are properly documented with JSDoc
3. Types reference existing ChunkMetadata from pinecone.ts
</verification>

<success_criteria>
- apps/workers/src/validation/types.ts exists with 8 interfaces
- apps/workers/src/validation/index.ts re-exports all types
- No TypeScript errors when compiling the validation module
- Types are properly documented for IDE autocompletion
</success_criteria>

<output>
After completion, create `.planning/phases/06-data-processing/06-01-SUMMARY.md`
</output>
