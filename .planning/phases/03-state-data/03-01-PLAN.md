---
phase: 03-state-data
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/workers/src/texas/types.ts
  - apps/workers/src/lib/citations.ts
  - apps/workers/package.json
autonomous: true

must_haves:
  truths:
    - "Texas-specific types exist for statutes and TAC data structures"
    - "Texas Bluebook citation generators produce correct format"
    - "Cheerio dependency installed and available"
  artifacts:
    - path: "apps/workers/src/texas/types.ts"
      provides: "TexasStatuteSection, TACRule, TexasChunk, TexasCheckpoint interfaces"
      min_lines: 100
    - path: "apps/workers/src/lib/citations.ts"
      provides: "generateTexasStatuteCitation, generateTACCitation functions"
      exports: ["generateTexasStatuteCitation", "generateTACCitation", "generateStatuteUrl", "generateTACUrl"]
  key_links:
    - from: "apps/workers/src/texas/types.ts"
      to: "apps/workers/src/federal/types.ts"
      via: "parallel structure"
      pattern: "interface.*Chunk"
---

<objective>
Create Texas state data pipeline foundation with types, citation utilities, and dependencies.

Purpose: Establish TypeScript interfaces and citation generators that all subsequent Texas pipeline plans will use. Mirrors the Phase 2 types.ts + citations.ts pattern but for Texas-specific data structures.

Output:
- Texas types file with statute, TAC, chunk, and checkpoint interfaces
- Extended citations.ts with Texas Bluebook format generators
- Cheerio dependency installed for HTML parsing
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-state-data/03-RESEARCH.md

# Reference existing federal types for structure
@apps/workers/src/federal/types.ts
@apps/workers/src/lib/citations.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Texas types with statute and TAC interfaces</name>
  <files>apps/workers/src/texas/types.ts</files>
  <action>
Create a new texas/ directory under apps/workers/src/ and add types.ts with the following interfaces:

1. **TexasCode** - Top-level Texas Statutes grouping:
   - abbreviation: string (e.g., "PE" for Penal, "HS" for Health & Safety)
   - name: string (full code name)
   - chapters: TexasChapter[]

2. **TexasChapter** - Chapter within a code:
   - number: string
   - name: string
   - sections: TexasStatuteSection[]

3. **TexasStatuteSection** - Individual statute section:
   - code: string (abbreviation)
   - chapter: string
   - section: string (e.g., "30.02")
   - heading: string
   - text: string
   - subsections?: TexasSubsection[]
   - sourceUrl: string
   - scrapedAt: string (ISO 8601)

4. **TexasSubsection** - Subdivision within a section:
   - id: string (e.g., "(a)", "(a)(1)")
   - text: string

5. **TACTitle** - Texas Administrative Code title:
   - number: number (e.g., 16, 22, 25, 30, 37)
   - name: string
   - chapters: TACChapter[]

6. **TACChapter** - TAC chapter:
   - number: string
   - name: string
   - rules: TACRule[]

7. **TACRule** - Individual TAC rule (equivalent to CFR section):
   - title: number
   - chapter: string
   - section: string
   - heading: string
   - text: string
   - subsections?: TexasSubsection[]
   - sourceUrl: string
   - scrapedAt: string

8. **TexasChunk** - Processed chunk ready for embedding (mirrors CFRChunk):
   - chunkId: string
   - sourceId: string
   - sourceType: 'tx-statute' | 'tx-tac'
   - text: string
   - citation: string
   - url: string
   - code?: string (for statutes)
   - tacTitle?: number (for TAC)
   - chapter: string
   - section: string
   - subsection?: string
   - hierarchy: string[]
   - category?: string
   - chunkIndex: number
   - totalChunks: number

9. **TexasCheckpoint** - Pipeline checkpoint for resumption:
   - sourceType: 'statute' | 'tac'
   - lastProcessedCode?: string (for statutes: "AG", "AL", etc.)
   - lastProcessedTitle?: number (for TAC: 16, 22, etc.)
   - timestamp: string
   - chunksProcessed: number
   - status: 'in_progress' | 'completed' | 'failed'
   - error?: string

10. **TexasCodeConfig** - Configuration for target codes:
    - abbreviation: string
    - name: string
    - categories: string[]
    - enabled: boolean

11. **TACTitleConfig** - Configuration for target TAC titles:
    - number: number
    - name: string
    - categories: string[]
    - enabled: boolean

Add constants:
- TARGET_STATUTES: TexasCodeConfig[] - List of 27 relevant Texas code abbreviations for retail compliance (prioritize: OC, HS, AL, TX, LA, PE, BC, IN)
- TARGET_TAC_TITLES: TACTitleConfig[] - 5 target TAC titles (16 Economic Regulation, 22 Health Services, 25 Environmental Quality, 30 Environmental Quality, 37 Licensure)

Add helper functions:
- getEnabledStatuteCodes(): TexasCodeConfig[]
- getEnabledTACTitles(): TACTitleConfig[]
- getCategoriesForCode(abbreviation: string): string[]
- getCategoriesForTACTitle(titleNumber: number): string[]

Reference the CFR types structure but adapt for Texas-specific hierarchy.
  </action>
  <verify>
```bash
cd /Users/noahmogil/Projects/compliance-iq && pnpm -F @compliance-iq/workers exec tsc --noEmit apps/workers/src/texas/types.ts
```
No TypeScript errors.
  </verify>
  <done>
Texas types file exists with all interfaces and constants defined. TypeScript compiles without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Texas citation generators to citations.ts</name>
  <files>apps/workers/src/lib/citations.ts</files>
  <action>
Extend the existing citations.ts file with Texas-specific citation generators. Add the following functions after the existing CFR functions:

1. **generateTexasStatuteCitation(code: string, section: string, year?: number): string**
   - Format: "Tex. [Code Name] Ann. ยง [section] (West [year])"
   - Use the code abbreviation map from research (AG -> Agric. Code, AL -> Alco. Bev. Code, etc.)
   - Default year to current year if not provided
   - Example: generateTexasStatuteCitation('PE', '30.02', 2026) => "Tex. Penal Code Ann. ยง 30.02 (West 2026)"

2. **generateTACCitation(title: number, section: string, year?: number): string**
   - Format: "[Title] Tex. Admin. Code ยง [section] ([year])"
   - Example: generateTACCitation(16, '5.31', 2026) => "16 Tex. Admin. Code ยง 5.31 (2026)"

3. **generateStatuteUrl(code: string, section: string): string**
   - Format: "https://statutes.capitol.texas.gov/Docs/[CODE]/htm/[CODE].[section].htm"
   - Example: generateStatuteUrl('PE', '30.02') => "https://statutes.capitol.texas.gov/Docs/PE/htm/PE.30.02.htm"

4. **generateTACUrl(title: number, section: string): string**
   - Use the SOS TAC URL pattern
   - Example: generateTACUrl(16, '5.31') => SOS TAC URL

5. **generateTexasChunkId(sourceType: 'statute' | 'tac', code: string | number, chapter: string, section: string, chunkIndex: number): string**
   - Format: "tx-{sourceType}-{code}-{chapter}-{section}-{chunkIndex}"
   - Example: generateTexasChunkId('statute', 'PE', '30', '30.02', 0) => "tx-statute-PE-30-30.02-0"

6. **generateTexasSourceId(sourceType: 'statute' | 'tac', code: string | number): string**
   - Format: "tx-{sourceType}-{code}"
   - Example: generateTexasSourceId('statute', 'PE') => "tx-statute-PE"

7. **generateTexasHierarchy(sourceType: 'statute' | 'tac', ...): string[]**
   - For statutes: ["Texas Statutes", "{Code Name}", "Chapter {chapter}", "Section {section}"]
   - For TAC: ["Texas Admin Code", "Title {number}", "Chapter {chapter}", "Section {section}"]

Include the full code abbreviation map from research:
```typescript
const TEXAS_CODE_ABBREVIATIONS: Record<string, string> = {
  'AG': 'Agric. Code',
  'AL': 'Alco. Bev. Code',
  'BC': 'Bus. & Com. Code',
  'BO': 'Bus. Orgs. Code',
  'CP': 'Civ. Prac. & Rem. Code',
  'CR': 'Crim. Proc. Code',
  'ED': 'Educ. Code',
  'EL': 'Elec. Code',
  'ES': 'Estates Code',
  'FA': 'Fam. Code',
  'FI': 'Fin. Code',
  'GV': 'Gov\'t Code',
  'HS': 'Health & Safety Code',
  'HR': 'Hum. Res. Code',
  'IN': 'Ins. Code',
  'LA': 'Lab. Code',
  'LG': 'Loc. Gov\'t Code',
  'NR': 'Nat. Res. Code',
  'OC': 'Occ. Code',
  'PW': 'Parks & Wild. Code',
  'PE': 'Penal Code',
  'PR': 'Prop. Code',
  'SD': 'Spec. Dist. Local Laws Code',
  'TX': 'Tax Code',
  'TN': 'Transp. Code',
  'UT': 'Util. Code',
  'WA': 'Water Code',
};
```

Export all new functions.
  </action>
  <verify>
```bash
cd /Users/noahmogil/Projects/compliance-iq && pnpm -F @compliance-iq/workers exec tsc --noEmit apps/workers/src/lib/citations.ts
```
No TypeScript errors. All new functions exported.
  </verify>
  <done>
Texas citation generators added to citations.ts. Functions produce correct Bluebook format. All exported.
  </done>
</task>

<task type="auto">
  <name>Task 3: Install Cheerio dependency for HTML parsing</name>
  <files>apps/workers/package.json</files>
  <action>
Add cheerio dependency to the workers package for HTML parsing:

```bash
cd /Users/noahmogil/Projects/compliance-iq/apps/workers && pnpm add cheerio
```

This installs cheerio ^1.0.0 which is TypeScript-native (no @types/cheerio needed).

After installation, verify by creating a simple import test in the types file or a temporary test file.
  </action>
  <verify>
```bash
cd /Users/noahmogil/Projects/compliance-iq/apps/workers && pnpm list cheerio
```
Shows cheerio is installed. Package.json includes cheerio dependency.
  </verify>
  <done>
Cheerio ^1.0.0 installed in apps/workers. Package.json updated with dependency.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Run TypeScript check on new files:
```bash
cd /Users/noahmogil/Projects/compliance-iq && pnpm -F @compliance-iq/workers exec tsc --noEmit
```

2. Verify Texas types file structure:
```bash
ls -la /Users/noahmogil/Projects/compliance-iq/apps/workers/src/texas/
```

3. Verify cheerio installation:
```bash
cd /Users/noahmogil/Projects/compliance-iq/apps/workers && pnpm list cheerio
```
</verification>

<success_criteria>
- apps/workers/src/texas/types.ts exists with all interfaces
- apps/workers/src/lib/citations.ts exports Texas citation functions
- cheerio is installed in apps/workers/package.json
- All TypeScript compiles without errors
- TARGET_STATUTES and TARGET_TAC_TITLES constants defined
</success_criteria>

<output>
After completion, create `.planning/phases/03-state-data/03-01-SUMMARY.md`
</output>
